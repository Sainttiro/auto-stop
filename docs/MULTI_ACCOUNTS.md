# üîÑ –ú—É–ª—å—Ç–∏–∞–∫–∫–∞—É–Ω—Ç—ã

–°–∏—Å—Ç–µ–º–∞ Auto-Stop –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å—á–µ—Ç–∞–º–∏ Tinkoff —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é **–≥–æ—Ä—è—á–µ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [–ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö](#–º–∏–≥—Ä–∞—Ü–∏—è-—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö-–¥–∞–Ω–Ω—ã—Ö)
- [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-—á–µ—Ä–µ–∑-telegram)
- [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏](#—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ-–¥–µ—Ç–∞–ª–∏)

---

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **–ù–µ—Å–∫–æ–ª—å–∫–æ —Å—á–µ—Ç–æ–≤** - –¥–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—á–µ—Ç–æ–≤ Tinkoff
- ‚úÖ **–ì–æ—Ä—è—á–µ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ** - –ø–µ—Ä–µ–∫–ª—é—á–∞–π—Ç–µ—Å—å –º–µ–∂–¥—É —Å—á–µ—Ç–∞–º–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
- ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ** - —Ç–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–π –ë–î
- ‚úÖ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram** - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è** - –ø—Ä–æ—Å—Ç–æ–π –ø–µ—Ä–µ—Ö–æ–¥ —Å –æ–¥–Ω–æ–≥–æ —Å—á–µ—Ç–∞ –Ω–∞ –º—É–ª—å—Ç–∏–∞–∫–∫–∞—É–Ω—Ç—ã

---

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

–ï—Å–ª–∏ –≤—ã —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Å–∏—Å—Ç–µ–º—É —Å –æ–¥–Ω–∏–º —Å—á–µ—Ç–æ–º, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é:

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –í–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker compose exec auto-stop python scripts/migrate_to_multiaccounts.py

# –ò–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
python scripts/migrate_to_multiaccounts.py
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—Å—Ç –∞–∫–∫–∞—É–Ω—Ç `main` –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Ç–æ–∫–µ–Ω–∞ –≤ `.env` –∏ –ø–æ–º–µ—Ç–∏—Ç –µ–≥–æ –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω—ã–π.

```
‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!
–°–æ–∑–¥–∞–Ω –∞–∫–∫–∞—É–Ω—Ç: main
Account ID: 2000012345
–ê–∫—Ç–∏–≤–Ω—ã–π: True
```

### –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É

```bash
docker compose restart
```

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω –∏–∑ –ë–î –≤–º–µ—Å—Ç–æ `.env`.

---

## üì± –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram

### –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/accounts` | –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—á–µ—Ç–æ–≤ |
| `/current_account` | –¢–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π —Å—á–µ—Ç |
| `/add_account` | –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å—á–µ—Ç |
| `/switch_account` | –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å—á–µ—Ç (–±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞!) |
| `/remove_account` | –£–¥–∞–ª–∏—Ç—å —Å—á–µ—Ç |

---

### `/accounts` - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—á–µ—Ç–æ–≤

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Å—á–µ—Ç–∞ —Å –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π –∞–∫—Ç–∏–≤–Ω–æ–≥–æ:

```
üìä –°—á–µ—Ç–∞ Tinkoff

üü¢ main (–∞–∫—Ç–∏–≤–Ω—ã–π)
   üÜî ID: 2000012345
   üìÑ –û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç
   üïê –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: 20.10.2025 14:30

‚ö™ reserve
   üÜî ID: 2000067890
   üìÑ –†–µ–∑–µ—Ä–≤–Ω—ã–π —Å—á–µ—Ç
   üïê –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: 15.10.2025 10:15
```

---

### `/add_account` - –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å—á–µ—Ç

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å:**
```
/add_account <–Ω–∞–∑–≤–∞–Ω–∏–µ> <—Ç–æ–∫–µ–Ω> <account_id> [–æ–ø–∏—Å–∞–Ω–∏–µ]
```

**–ü—Ä–∏–º–µ—Ä:**
```
/add_account reserve t.xxx...xxx 2000067890 –†–µ–∑–µ—Ä–≤–Ω—ã–π —Å—á–µ—Ç
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ –ê–∫–∫–∞—É–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω!

üìù –ù–∞–∑–≤–∞–Ω–∏–µ: reserve
üÜî Account ID: 2000067890
üìÑ –û–ø–∏—Å–∞–Ω–∏–µ: –†–µ–∑–µ—Ä–≤–Ω—ã–π —Å—á–µ—Ç

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /switch_account reserve –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
```

‚ö†Ô∏è **–í–∞–∂–Ω–æ:**
- –°–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–æ–∫–µ–Ω–æ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º
- Account ID –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ Tinkoff

---

### `/switch_account` - –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Å—á–µ—Ç

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å:**
```
/switch_account <–Ω–∞–∑–≤–∞–Ω–∏–µ>
```

**–ü—Ä–∏–º–µ—Ä:**
```
/switch_account reserve
```

**–ü—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è:**

1. –°–∏—Å—Ç–µ–º–∞ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π stream handler
2. –ó–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å API
3. –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Ç–æ–∫–µ–Ω–æ–º –Ω–æ–≤–æ–≥–æ —Å—á–µ—Ç–∞
4. –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
5. –ó–∞–ø—É—Å–∫–∞–µ—Ç stream handler –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å—á–µ—Ç–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
üîÑ –ü–µ—Ä–µ–∫–ª—é—á–∞—é—Å—å –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç reserve...
‚è≥ –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ API...

‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!

üü¢ –ê–∫—Ç–∏–≤–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç: reserve
üÜî Account ID: 2000067890
üìÑ –û–ø–∏—Å–∞–Ω–∏–µ: –†–µ–∑–µ—Ä–≤–Ω—ã–π —Å—á–µ—Ç

üîÑ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞!
```

‚è± **–í—Ä–µ–º—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è:** ~5-10 —Å–µ–∫—É–Ω–¥

---

### `/current_account` - –¢–µ–∫—É—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π —Å—á–µ—Ç

–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –∞–∫—Ç–∏–≤–Ω–æ–º —Å—á–µ—Ç–µ:

```
üü¢ –ê–∫—Ç–∏–≤–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç

üìù –ù–∞–∑–≤–∞–Ω–∏–µ: main
üÜî Account ID: 2000012345
üìÑ –û–ø–∏—Å–∞–Ω–∏–µ: –û—Å–Ω–æ–≤–Ω–æ–π —Å—á–µ—Ç
üïê –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: 20.10.2025 14:30:45
üìÖ –°–æ–∑–¥–∞–Ω: 15.10.2025 10:00
```

---

### `/remove_account` - –£–¥–∞–ª–∏—Ç—å —Å—á–µ—Ç

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å:**
```
/remove_account <–Ω–∞–∑–≤–∞–Ω–∏–µ>
```

**–ü—Ä–∏–º–µ—Ä:**
```
/remove_account old_account
```

‚ö†Ô∏è **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç
- –°–Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ –¥—Ä—É–≥–æ–π –∞–∫–∫–∞—É–Ω—Ç

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ —Å—á–µ—Ç–∞

```bash
# 1. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å—á–µ—Ç
/add_account trading2 t.xxx...xxx 2000067890 –í—Ç–æ—Ä–æ–π —Ç–æ—Ä–≥–æ–≤—ã–π —Å—á–µ—Ç

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å—á–µ—Ç–æ–≤
/accounts

# 3. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –Ω–æ–≤—ã–π —Å—á–µ—Ç
/switch_account trading2

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—á–µ—Ç
/current_account
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Å—á–µ—Ç–∞–º–∏

```bash
# –£—Ç—Ä–æ–º - —Ä–∞–±–æ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–º —Å—á–µ—Ç–µ
/switch_account main

# –î–Ω–µ–º - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Å—á–µ—Ç
/switch_account aggressive

# –í–µ—á–µ—Ä–æ–º - –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π
/switch_account main
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ —Å—á–µ—Ç–∞

```bash
# 1. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –¥—Ä—É–≥–æ–π —Å—á–µ—Ç
/switch_account main

# 2. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π —Å—á–µ—Ç
/remove_account old_account
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Telegram Bot Commands           ‚îÇ
‚îÇ  /add_account  /switch_account  etc.    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Database (SQLite)               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ accounts                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - id                              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - name (unique)                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - token (encrypted)               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - account_id                      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - is_active (only one = true)     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - last_used_at                    ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      AutoStopSystem.reload_api_client() ‚îÇ
‚îÇ                                         ‚îÇ
‚îÇ  1. Stop stream handler                ‚îÇ
‚îÇ  2. Close current API client           ‚îÇ
‚îÇ  3. Create new API client (new token)  ‚îÇ
‚îÇ  4. Reinitialize components            ‚îÇ
‚îÇ  5. Start stream handler (new account) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–∏—Å—Ç–µ–º—ã:

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î** - –∏—â–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ `accounts`
2. **Fallback –Ω–∞ .env** - –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `TINKOFF_TOKEN` –∏–∑ `.env`

```python
# –õ–æ–≥–∏–∫–∞ –≤ main.py
active_account = await database.get_active_account()

if active_account:
    token = active_account.token
    account_id = active_account.account_id
else:
    token = config.api.token  # –∏–∑ .env
    account_id = config.account_id
```

### –ì–æ—Ä—è—á–µ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

–ú–µ—Ç–æ–¥ `reload_api_client()` –≤—ã–ø–æ–ª–Ω—è–µ—Ç:

```python
async def reload_api_client(self, new_account_name: str):
    # 1. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤ –ë–î
    await database.switch_account(new_account_name)
    
    # 2. –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç
    active_account = await database.get_active_account()
    
    # 3. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å stream handler
    await stream_handler.stop()
    
    # 4. –ó–∞–∫—Ä—ã—Ç—å API –∫–ª–∏–µ–Ω—Ç
    await api_client.__aexit__()
    
    # 5. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π API –∫–ª–∏–µ–Ω—Ç
    api_client = TinkoffAPIClient(token=active_account.token)
    
    # 6. –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    # ... instrument_cache, order_executor, strategies ...
    
    # 7. –ó–∞–ø—É—Å—Ç–∏—Ç—å stream handler
    await stream_handler.start(active_account.account_id)
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –¢–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ)
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è —Å —Ç–æ–∫–µ–Ω–∞–º–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
- ‚úÖ –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –∞–∫—Ç–∏–≤–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç

---

## ‚ùì FAQ

### –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏?

–î–∞, —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏. –ï—Å–ª–∏ –≤ –ë–î –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–∫–µ–Ω –∏–∑ `.env`.

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –ø–æ–∑–∏—Ü–∏—è–º–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏?

–ü–æ–∑–∏—Ü–∏–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ `account_id`. –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Å—á–µ—Ç–∞:
- –°—Ç–∞—Ä—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –ë–î
- –ù–æ–≤—ã–π stream handler –Ω–∞—á–∏–Ω–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ —Å—á–µ—Ç–∞

### –ú–æ–∂–Ω–æ –ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É —Å—á–µ—Ç–∞–º–∏ —Å –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏?

–î–∞, –Ω–æ —É—á—Ç–∏—Ç–µ:
- –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å—á–µ—Ç–∞
- SL/TP –æ—Ä–¥–µ—Ä–∞ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –Ω–∞ –±–∏—Ä–∂–µ
- –ü—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Å—á–µ—Ç –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –∑–∞–Ω–æ–≤–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏

### –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω–∏–º–∞–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ?

–û–±—ã—á–Ω–æ 5-10 —Å–µ–∫—É–Ω–¥:
- –û—Å—Ç–∞–Ω–æ–≤–∫–∞ stream handler: ~2 —Å–µ–∫
- –ó–∞–∫—Ä—ã—Ç–∏–µ/–æ—Ç–∫—Ä—ã—Ç–∏–µ API: ~1 —Å–µ–∫
- –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: ~2 —Å–µ–∫
- –ó–∞–ø—É—Å–∫ stream handler: ~2 —Å–µ–∫

---

## üöÄ Roadmap

- [ ] –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ë–î
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–∂–¥–æ–º—É —Å—á–µ—Ç—É
- [ ] –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å—á–µ—Ç–æ–≤
- [ ] Web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

## üìù Changelog

### v1.1.0 (2025-10-20)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º—É–ª—å—Ç–∏–∞–∫–∫–∞—É–Ω—Ç–æ–≤
- ‚úÖ –ì–æ—Ä—è—á–µ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ Telegram –±–æ—Ç–µ
- ‚úÖ –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤: –ë–î > .env

---

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker compose logs -f auto-stop`
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/current_account` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å—á–µ—Ç–∞
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –æ–±—Ä–∞—Ç–Ω–æ: `/switch_account main`
4. –°–æ–æ–±—â–∏—Ç–µ –æ–± –æ—à–∏–±–∫–µ: `/reportbug`

---

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞:** 20.10.2025

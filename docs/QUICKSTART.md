# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç Auto-Stop

–ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ.

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- ‚úÖ –°–µ—Ä–≤–µ—Ä —Å Ubuntu (20.04/22.04/24.04)
- ‚úÖ Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ Tinkoff Invest —Ç–æ–∫–µ–Ω
- ‚úÖ Telegram –±–æ—Ç —Ç–æ–∫–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ GitHub –∞–∫–∫–∞—É–Ω—Ç (–¥–ª—è CI/CD)

## –í–∞—Ä–∏–∞–Ω—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏

–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ –¥–≤—É—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (SSH)

#### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub

1. –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `auto-stop` –Ω–∞ GitHub (–ø—É–±–ª–∏—á–Ω—ã–π)
2. –î–æ–±–∞–≤—å—Ç–µ Secrets –≤ Settings ‚Üí Secrets and variables ‚Üí Actions:
   - `SERVER_HOST`: IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
   - `SERVER_USER`: –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - `SERVER_PORT`: SSH –ø–æ—Ä—Ç (–æ–±—ã—á–Ω–æ 22 –∏–ª–∏ 2222)
   - `SERVER_SSH_KEY`: –≤–∞—à –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á

#### –®–∞–≥ 2: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh user@your-server-ip -p 22

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
sudo mkdir -p /opt/projects/auto-stop
sudo chown $USER:$USER /opt/projects/auto-stop
cd /opt/projects/auto-stop

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–ø–æ—Å–ª–µ push –≤ GitHub)
git clone https://github.com/yourusername/auto-stop.git .
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å Tailscale VPN (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–≠—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ VPN, –¥–∞–∂–µ –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∑–∞ NAT –∏–ª–∏ –Ω–µ –∏–º–µ–µ—Ç –ø—É–±–ª–∏—á–Ω–æ–≥–æ IP.

#### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Tailscale

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Tailscale –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ –≤–∞—à –∫–æ–º–ø—å—é—Ç–µ—Ä (https://tailscale.com/download)
2. –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç Tailscale –Ω–∞ –æ–±–æ–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
3. –û—Ç–∫—Ä–æ–π—Ç–µ https://login.tailscale.com/admin/settings/keys
4. –ù–∞–∂–º–∏—Ç–µ **Generate auth key**
5. –í–∫–ª—é—á–∏—Ç–µ:
   - ‚úÖ Reusable
   - ‚úÖ Ephemeral
6. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `tskey-auth-...`)
7. –£–∑–Ω–∞–π—Ç–µ Tailscale IP –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –∫–æ–º–∞–Ω–¥–æ–π `tailscale ip -4`

#### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub

1. –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `auto-stop` –Ω–∞ GitHub (–ø—É–±–ª–∏—á–Ω—ã–π)
2. –î–æ–±–∞–≤—å—Ç–µ Secrets –≤ Settings ‚Üí Secrets and variables ‚Üí Actions:
   - `TAILSCALE_AUTH_KEY`: –≤–∞—à auth key –∏–∑ —à–∞–≥–∞ 1
   - `SERVER_HOST`: –≤–∞—à Tailscale IP (–∏–∑ –∫–æ–º–∞–Ω–¥—ã `tailscale ip -4`)
   - `SERVER_USER`: –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
   - `SERVER_PORT`: SSH –ø–æ—Ä—Ç (–æ–±—ã—á–Ω–æ 22 –∏–ª–∏ 2222)
   - `SERVER_SSH_KEY`: –≤–∞—à –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á

#### –®–∞–≥ 3: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ Tailscale IP
ssh user@tailscale-ip -p 22

# –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
sudo mkdir -p /opt/projects/auto-stop
sudo chown $USER:$USER /opt/projects/auto-stop
cd /opt/projects/auto-stop

# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (–ø–æ—Å–ª–µ push)
git clone https://github.com/yourusername/auto-stop.git .
```

## –û–±—â–∏–µ —à–∞–≥–∏ (–¥–ª—è –æ–±–æ–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞
nano .env
```

–°–æ–¥–µ—Ä–∂–∏–º–æ–µ `.env`:
```env
TINKOFF_TOKEN=your_token_here
ACCOUNT_ID=your_account_id
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id
GITHUB_REPOSITORY=yourusername/auto-stop
VERSION=latest
LOG_LEVEL=INFO
```

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
mkdir -p data logs
```

### –®–∞–≥ 2: –î–µ–ø–ª–æ–π

```bash
# –ù–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
cd /path/to/auto-stop

# Commit –∏ push
git add .
git commit -m "Initial setup"
git push origin main

# –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ª–∏–∑–∞
git tag v1.0.0
git push origin v1.0.0
```

GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –°–æ–±–µ—Ä–µ—Ç Docker –æ–±—Ä–∞–∑
2. –ó–∞–¥–µ–ø–ª–æ–∏—Ç –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ SSH (–∏–ª–∏ Tailscale VPN)

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /opt/projects/auto-stop
docker compose ps
docker compose logs -f
```

### –®–∞–≥ 4: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É:
- `/start` - –Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã
- `/status` - —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
- `/positions` - —Ç–µ–∫—É—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏
- `/settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SL/TP
- `/accounts` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏

### –®–∞–≥ 5: –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –õ–æ–≥–∏
./scripts/logs.sh

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
./scripts/update.sh

# –ë—ç–∫–∞–ø
./scripts/backup.sh

# –°—Ç–∞—Ç—É—Å
docker compose ps
```

## –ì–æ—Ç–æ–≤–æ! üéâ

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç SL/TP –Ω–∞ –≤–∞—à–∏ –ø–æ–∑–∏—Ü–∏–∏.

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Actions](GITHUB_SETUP.md)
- [–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –¥–µ–ø–ª–æ—é](DEPLOYMENT.md)
- [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Tailscale](TAILSCALE_SETUP.md)
- [–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](TROUBLESHOOTING.md)
- [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è](CRITICAL_FIXES.md)

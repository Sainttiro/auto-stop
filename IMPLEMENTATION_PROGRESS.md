# –ü—Ä–æ–≥—Ä–µ—Å—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ —á–µ—Ä–µ–∑ Telegram

## ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û (21.10.2025, 18:25)

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –Ω–∞ 100%

–í—Å–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Å–∏—Å—Ç–µ–º—É.

---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –º–æ–¥–µ–ª–∏
- ‚úÖ `GlobalSettings` - –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (SL/TP, Multi-TP)
- ‚úÖ `InstrumentSettings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ JSON –¥–ª—è Multi-TP —É—Ä–æ–≤–Ω–µ–π
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π constraint –Ω–∞ account_id + ticker

### 2. SettingsManager (`src/config/settings_manager.py`)
- ‚úÖ CRUD –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
- ‚úÖ CRUD –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ `get_effective_settings()` —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è Multi-TP —É—Ä–æ–≤–Ω–µ–π
- ‚úÖ JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è

### 3. Telegram –º–µ–Ω—é (`src/bot/settings_menu.py`)
**–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
- ‚úÖ –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ SL (—Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π 0.1-10%)
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ TP (—Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π 0.1-20%)

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:**
- ‚úÖ –°–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ SL –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ (0.1-10%)
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ TP –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ (0.1-20%)
- ‚úÖ –°–±—Ä–æ—Å –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞

**–û–±—â–µ–µ:**
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ (—Å–≤–æ–¥–∫–∞)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ callback –∫–Ω–æ–ø–æ–∫
- ‚úÖ ConversationHandler —Å–æ—Å—Ç–æ—è–Ω–∏—è
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞

### 4. Database
- ‚úÖ –ú–µ—Ç–æ–¥ `get_position_by_ticker()` –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –≠—Ç–∞–ø 2A: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
- [x] –ü—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
- [x] –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ SL/TP –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
- [x] –£–¥–∞–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–≤–æ–∑–≤—Ä–∞—Ç –∫ –≥–ª–æ–±–∞–ª—å–Ω—ã–º)

### –≠—Ç–∞–ø 2B: Multi-TP –º–µ–Ω—é ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [x] –ú–µ–Ω—é Multi-TP (–≥–ª–æ–±–∞–ª—å–Ω–æ–µ –∏ –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤)
- [x] –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ Multi-TP
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è (level_pct, volume_pct)
- [x] –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è
- [x] –£–¥–∞–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
- [x] –í–∞–ª–∏–¥–∞—Ü–∏—è: —Å—É–º–º–∞ = 100%, –ø–æ—Ä—è–¥–æ–∫ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—è

### –≠—Ç–∞–ø 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å RiskCalculator ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [x] –û–±–Ω–æ–≤–∏—Ç—å RiskCalculator –¥–ª—è —á—Ç–µ–Ω–∏—è –∏–∑ –ë–î
- [x] –ü–µ—Ä–µ–¥–∞—Ç—å SettingsManager –≤ RiskCalculator
- [x] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `get_effective_settings()` –≤–º–µ—Å—Ç–æ YAML
- [x] –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ë–î > YAML > defaults
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –≠—Ç–∞–ø 4: –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [x] –ö–æ–º–∞–Ω–¥–∞ `/settings` - –æ—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ConversationHandler –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç
- [x] –í—Å–µ 18 —Å–æ—Å—Ç–æ—è–Ω–∏–π ConversationHandler
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö callback –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

### –≠—Ç–∞–ø 5: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
- [x] –û–±–Ω–æ–≤–ª–µ–Ω CHANGELOG.md (v2.1.0)
- [x] –û–±–Ω–æ–≤–ª–µ–Ω IMPLEMENTATION_PROGRESS.md
- [x] –û–±–Ω–æ–≤–ª–µ–Ω NEXT_STEPS.md

## üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Telegram Bot (/settings)
    ‚Üì
SettingsMenu (UI + ConversationHandler)
    ‚Üì
SettingsManager (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ + –≤–∞–ª–∏–¥–∞—Ü–∏—è)
    ‚Üì
Database (GlobalSettings, InstrumentSettings)
    ‚Üì
RiskCalculator (—á–∏—Ç–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ –ë–î)
    ‚Üì
OrderExecutor (–≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ä–¥–µ—Ä–∞)
```

## üìä –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫

```
1. InstrumentSettings (–¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–∫–µ—Ä–∞)
   ‚Üì –µ—Å–ª–∏ NULL ‚Üì
2. GlobalSettings (–¥–ª—è –∞–∫–∫–∞—É–Ω—Ç–∞)
   ‚Üì –µ—Å–ª–∏ NULL ‚Üì
3. Defaults (hardcoded: SL=0.4%, TP=1.0%)
```

## üîß –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã)
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö SL/TP
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ SL/TP –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- ‚úÖ Multi-TP —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω–µ–π)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å RiskCalculator (—á—Ç–µ–Ω–∏–µ –∏–∑ –ë–î)
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ `/settings` –≤ Telegram –±–æ—Ç–µ
- ‚úÖ ConversationHandler —Å 18 —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏
- ‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ–Ω—é
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–≤–æ–¥–∞
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–ë–î ‚Üí YAML ‚Üí defaults)

## üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

1. **ConversationHandler** - 18 —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–º
2. **InlineKeyboard** - –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ–Ω—é
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –Ω–∞ —É—Ä–æ–≤–Ω–µ SettingsManager –∏ UI
4. **JSON** - —Ö—Ä–∞–Ω–µ–Ω–∏–µ Multi-TP —É—Ä–æ–≤–Ω–µ–π –≤ –ë–î
5. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç** - –ë–î > YAML > hardcoded defaults
6. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ –ë–î

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–ü—Ä–æ–≥—Ä–µ—Å—Å: 100% –∑–∞–≤–µ—Ä—à–µ–Ω–æ**

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç:
- –£–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç (`/settings`)
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã SL/TP
- –°–æ–∑–¥–∞–≤–∞—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Multi-TP —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ –≤—ã—Ö–æ–¥–∞
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–∏—Å—Ç–µ–º—ã

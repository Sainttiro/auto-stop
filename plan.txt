üß† –ü–†–û–ú–¢ –î–õ–Ø CLAUDE

–¢–µ–º–∞: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ-–≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—Ç–æ–ø-–ª–æ—Å—Å–æ–≤ –∏ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–æ–≤ —á–µ—Ä–µ–∑ Tinkoff Invest API (gRPC)

üéØ –ö–æ–Ω—Ç–µ–∫—Å—Ç

–¢—ã ‚Äî –≤–µ–¥—É—â–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º –Ω–∞ –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –±–∏—Ä–∂–µ, —ç–∫—Å–ø–µ—Ä—Ç –ø–æ API Tinkoff Invest –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ Python-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –¥–ª—è –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏.
–ó–∞–¥–∞—á–∞ ‚Äî —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É, –∫–æ—Ç–æ—Ä–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç –∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —É—Ä–æ–≤–Ω–∏ —Å—Ç–æ–ø-–ª–æ—Å—Å–æ–≤ (SL) –∏ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–æ–≤ (TP) –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è —Å–¥–µ–ª–∫–∏ —á–µ—Ä–µ–∑ Tinkoff Invest API (gRPC), –∏—Å–ø–æ–ª—å–∑—É—è –±–∏–±–ª–∏–æ—Ç–µ–∫—É invest-python.

‚öôÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

–°—Ä–µ–¥–∞:

- –†–∞–±–æ—Ç–∞ –Ω–∞ Windows, macOS –∏ Linux (Ubuntu)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Python 3.10+
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ invest-python
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ gRPC-–º–µ—Ç–æ–¥–æ–≤ (–Ω–µ REST)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞–º–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –¥–µ–ø–ª–æ—è
- CI/CD —á–µ—Ä–µ–∑ GitHub Actions

–¶–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã:

- –ü–æ—Å–ª–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è —Å–¥–µ–ª–∫–∏ (–ø–æ–∫—É–ø–∫–∞/–ø—Ä–æ–¥–∞–∂–∞) ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—Å—Ç–∞–≤–ª—è—Ç—å SL –∏ TP —á–µ—Ä–µ–∑ gRPC-–º–µ—Ç–æ–¥—ã Tinkoff Invest API.
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã –ø–æ–∑–∏—Ü–∏–∏ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ª–æ—Ç–æ–≤ ‚Äî –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å –∏ –ø–µ—Ä–µ–≤—ã—Å—Ç–∞–≤–ª—è—Ç—å SL –∏ TP.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è:
  - –ê–∫—Ü–∏–π (–ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã)
  - –§—å—é—á–µ—Ä—Å–æ–≤ (—á–µ—Ä–µ–∑ —à–∞–≥ —Ü–µ–Ω—ã –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å —à–∞–≥–∞ –∏–ª–∏ –ø—Ä–æ—Ü–µ–Ω—Ç)
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–≥–æ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–∞ (—á–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ä–∞–∑–Ω—ã—Ö —Ü–µ–ª–µ–π –ø—Ä–∏–±—ã–ª–∏).
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º—É–ª—å—Ç–∏–∞–∫–∫–∞—É–Ω—Ç–æ–≤ —Å –≥–æ—Ä—è—á–∏–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞

–ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:

- –û–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã SL/TP –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —Ç–∏–∫–µ—Ä—É
- –û—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ—å—é—á–µ—Ä—Å—ã –Ω–∞ –∏–Ω–¥–µ–∫—Å, –≤–∞–ª—é—Ç—É, –∞–∫—Ü–∏–∏)
- –†–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä: +1%, +2%, +3% —Å —á–∞—Å—Ç–∏—á–Ω—ã–º –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ 25%, 25%, 50%)
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞
- –•—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º –Ω–∞–¥ YAML-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

–°—Ç–æ–π–∫–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

- –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏ –≤ SQLite –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É—Å—Ç–æ–π—á–∏–≤–∞ –∫ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –æ–±—Ä—ã–≤–∞–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è gRPC (–¥–æ 100 –ø–æ–ø—ã—Ç–æ–∫ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)
- –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ç–æ–∫–µ–Ω API) –¥–æ–ª–∂–Ω—ã —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ (env-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ / .env-—Ñ–∞–π–ª)
- –í–µ–¥–µ–Ω–∏–µ –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –ª–æ–≥–æ–≤ (–æ—à–∏–±–∫–∏, –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤, –ø–µ—Ä–µ—Å—á–µ—Ç—ã)
- –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ Tailscale VPN
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions

üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

/auto-stop/
‚îÇ
‚îú‚îÄ‚îÄ src/                      # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∫–ª–∞—Å—Å AutoStopSystem
‚îÇ   ‚îú‚îÄ‚îÄ api/                 # –†–∞–±–æ—Ç–∞ —Å Tinkoff Invest API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client.py        # TinkoffAPIClient - –æ–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ AsyncClient
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ instrument_info.py # –ö—ç—à –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö
‚îÇ   ‚îú‚îÄ‚îÄ core/                # –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stream_handler.py # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ gRPC-–ø–æ—Ç–æ–∫–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ order_executor.py # –í—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç–º–µ–Ω–∞ –æ—Ä–¥–µ—Ä–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ position_manager.py # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ risk_calculator.py # –†–∞—Å—á–µ—Ç —É—Ä–æ–≤–Ω–µ–π SL/TP
‚îÇ   ‚îú‚îÄ‚îÄ strategies/          # –¢–æ—Ä–≥–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py          # –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stock_sl_tp.py   # –°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è –∞–∫—Ü–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ futures_sl_tp.py # –°—Ç—Ä–∞—Ç–µ–≥–∏—è –¥–ª—è —Ñ—å—é—á–µ—Ä—Å–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ multi_tp.py      # –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç
‚îÇ   ‚îú‚îÄ‚îÄ storage/             # –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.py      # –†–∞–±–æ—Ç–∞ —Å SQLite
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.py        # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ config/              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loader.py        # –ó–∞–≥—Ä—É–∑–∫–∞ YAML-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings.py      # –ú–æ–¥–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings_manager.py # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –≤ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ bot/                 # Telegram –±–æ—Ç
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bot.py           # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –±–æ—Ç–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings_menu.py # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫
‚îÇ   ‚îú‚îÄ‚îÄ analytics/           # –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ operations_fetcher.py # –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π –∏–∑ API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ operations_cache.py # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ statistics.py    # –†–∞—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reports.py       # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ notifications/       # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ telegram.py      # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram
‚îÇ   ‚îî‚îÄ‚îÄ utils/               # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ       ‚îú‚îÄ‚îÄ logger.py        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ       ‚îî‚îÄ‚îÄ converters.py    # –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ
‚îú‚îÄ‚îÄ config/                  # YAML-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ config.yaml         # –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ instruments.yaml    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
‚îÇ
‚îú‚îÄ‚îÄ .github/workflows/       # CI/CD –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ release.yml         # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –ø—Ä–∏ —Ä–µ–ª–∏–∑–µ
‚îÇ   ‚îî‚îÄ‚îÄ test.yml            # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ
‚îú‚îÄ‚îÄ docs/                    # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ QUICKSTART.md       # –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–≤–∫–ª—é—á–∞—è Tailscale)
‚îÇ   ‚îú‚îÄ‚îÄ DEPLOYMENT.md       # –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ scripts/                 # –°–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ deploy.sh           # –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ update.sh           # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ docker-compose.yml       # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile              # Docker –æ–±—Ä–∞–∑
‚îî‚îÄ‚îÄ .env                    # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Ç–æ–∫–µ–Ω—ã)

üî¢ –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —É—Ä–æ–≤–Ω–µ–π

–î–ª—è –∞–∫—Ü–∏–π:
```python
if position.direction == "LONG":
    stop_price = avg_price * (1 - stop_loss_pct / 100)
    take_price = avg_price * (1 + take_profit_pct / 100)
else:  # SHORT
    stop_price = avg_price * (1 + stop_loss_pct / 100)
    take_price = avg_price * (1 - take_profit_pct / 100)
```

–î–ª—è —Ñ—å—é—á–µ—Ä—Å–æ–≤ (–Ω–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ - –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö):
```python
if position.direction == "LONG":
    stop_price = avg_price * (1 - stop_loss_pct / 100)
    take_price = avg_price * (1 + take_profit_pct / 100)
else:  # SHORT
    stop_price = avg_price * (1 + stop_loss_pct / 100)
    take_price = avg_price * (1 - take_profit_pct / 100)
```

–î–ª—è —Ñ—å—é—á–µ—Ä—Å–æ–≤ (—Å—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥ - –≤ —à–∞–≥–∞—Ö —Ü–µ–Ω—ã):
```python
if position.direction == "LONG":
    stop_price = avg_price - stop_loss_steps * instrument.price_step
    take_price = avg_price + take_profit_steps * instrument.price_step
else:  # SHORT
    stop_price = avg_price + stop_loss_steps * instrument.price_step
    take_price = avg_price - take_profit_steps * instrument.price_step
```

–î–ª—è –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–≥–æ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–∞:

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫ —É—Ä–æ–≤–Ω–µ–π —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞ –∏–ª–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```yaml
multi_take_profit:
  enabled: true
  levels:
    - level_pct: 1.0          # +1% –æ—Ç —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã
      volume_pct: 25          # –ó–∞–∫—Ä—ã—Ç—å 25% –ø–æ–∑–∏—Ü–∏–∏
    - level_pct: 2.0          # +2% –æ—Ç —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã
      volume_pct: 25          # –ó–∞–∫—Ä—ã—Ç—å 25% –ø–æ–∑–∏—Ü–∏–∏
    - level_pct: 3.0          # +3% –æ—Ç —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã
      volume_pct: 50          # –ó–∞–∫—Ä—ã—Ç—å 50% –ø–æ–∑–∏—Ü–∏–∏
```

–ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è ‚Äî –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –æ—Ä–¥–µ—Ä –Ω–∞ —á–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ.
–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É—é—Ç—Å—è –æ—Å—Ç–∞–≤—à–∏–µ—Å—è SL/TP —É—Ä–æ–≤–Ω–∏.

üì° –†–∞–±–æ—Ç–∞ —Å gRPC-–º–µ—Ç–æ–¥–∞–º–∏ Tinkoff Invest

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã –∏–∑ invest-python, –Ω–∞–ø—Ä–∏–º–µ—Ä:

- OrdersStreamService ‚Äî –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–π —Å–¥–µ–ª–æ–∫
- OrdersService.PostOrder ‚Äî –¥–ª—è –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è SL/TP –æ—Ä–¥–µ—Ä–æ–≤
- OrdersService.CancelOrder ‚Äî –¥–ª—è –ø–µ—Ä–µ–≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è
- InstrumentsService.GetInstrumentByTicker ‚Äî –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —à–∞–≥–∞ —Ü–µ–Ω—ã –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —à–∞–≥–∞ —Ñ—å—é—á–µ—Ä—Å–∞
- OperationsStreamService ‚Äî –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ–∑–∏—Ü–∏–π –∏ —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã
- UsersService.GetAccounts ‚Äî –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Å—á–µ—Ç–æ–≤

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —Ä–µ—Å—É—Ä—Å—ã:
- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API:** https://developer.tbank.ru/invest/api
  - –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤ API
  - gRPC —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ protobuf —Å—Ö–µ–º—ã
  - –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤

- **Python SDK (invest-python):** https://developer.tbank.ru/invest/sdk/python_sdk/faq_python
  - –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
  - FAQ –∏ —Ä–µ—à–µ–Ω–∏–µ —Ç–∏–ø–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
  - Best practices –∏ –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

- **MCP Server Context7:** https://context7.com/russianinvestments/invest-python
  - –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ò–ò –∞–≥–µ–Ω—Ç–æ–≤
  - –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API
  - –ü–æ–º–æ—â—å –≤ –ø–æ–Ω–∏–º–∞–Ω–∏–∏ –º–µ—Ç–æ–¥–æ–≤ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è invest-python —Å Context7:
```python
from tinkoff.invest import Client, OrderDirection, OrderType
from tinkoff.invest.utils import quotation_to_decimal

async def place_order_example():
    """
    –ü—Ä–∏–º–µ—Ä –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º invest-python.
    
    –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://context7.com/russianinvestments/invest-python
    """
    async with Client(token=TOKEN) as client:
        # –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–µ
        instrument = await client.instruments.get_instrument_by(
            id_type=InstrumentIdType.INSTRUMENT_ID_TYPE_TICKER,
            class_code="TQBR",
            id="SBER"
        )
        
        # –í—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞
        order_response = await client.orders.post_order(
            instrument_id=instrument.instrument.uid,
            quantity=10,
            price=quotation_to_decimal(instrument.instrument.min_price_increment),
            direction=OrderDirection.ORDER_DIRECTION_BUY,
            account_id=ACCOUNT_ID,
            order_type=OrderType.ORDER_TYPE_LIMIT,
            order_id=str(uuid.uuid4())
        )
        
        return order_response
```

üíæ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

- –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (SL/TP %, —à–∞–≥–∏, —É—Ä–æ–≤–Ω–∏ TP, —Ç–∏–∫–µ—Ä—ã, API-—Ç–æ–∫–µ–Ω) —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ config.yaml
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ SQLite –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ YAML)
- –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π –∏ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤ ‚Äî –≤ SQLite
- –¢–æ–∫–µ–Ω—ã –º—É–ª—å—Ç–∏–∞–∫–∫–∞—É–Ω—Ç–æ–≤ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î —Å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ–º
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –∏—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –∫—ç—à–∏—Ä—É—é—Ç—Å—è –≤ –ë–î

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–∏—Å—Ç–µ–º–∞:

1. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ API —á–µ—Ä–µ–∑ gRPC
2. –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∏–º –æ—Ä–¥–µ—Ä–æ–≤ –∏ –ø–æ–∑–∏—Ü–∏–π
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç SL/TP –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–∏

ü§ñ Telegram –±–æ—Ç

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–æ–π:

- –ö–æ–º–∞–Ω–¥—ã: /start, /status, /positions, /settings, /stats, /accounts, /help
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å –∫–Ω–æ–ø–∫–∞–º–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ SL/TP
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–≥–æ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–∞
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ—Ä–≥–æ–≤–ª–∏ (–¥–Ω–µ–≤–Ω–∞—è, –Ω–µ–¥–µ–ª—å–Ω–∞—è, –º–µ—Å—è—á–Ω–∞—è)
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –ø–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º

üöÄ CI/CD –∏ –¥–µ–ø–ª–æ–π

- GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥–µ–ø–ª–æ—è
- Tailscale VPN –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É
- Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–µ–ª–∏–∑–∞

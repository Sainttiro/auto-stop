üß† –ü–†–û–ú–¢ –î–õ–Ø CLAUDE

–¢–µ–º–∞: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ-–≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—Ç–æ–ø-–ª–æ—Å—Å–æ–≤ –∏ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–æ–≤ —á–µ—Ä–µ–∑ Tinkoff Invest API (gRPC)

üéØ –ö–æ–Ω—Ç–µ–∫—Å—Ç

–¢—ã ‚Äî –≤–µ–¥—É—â–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–æ—Ä–≥–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º –Ω–∞ –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –±–∏—Ä–∂–µ, —ç–∫—Å–ø–µ—Ä—Ç –ø–æ API Tinkoff Invest –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ Python-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –¥–ª—è –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏.
–ó–∞–¥–∞—á–∞ ‚Äî —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É, –∫–æ—Ç–æ—Ä–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç –∏ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç —É—Ä–æ–≤–Ω–∏ —Å—Ç–æ–ø-–ª–æ—Å—Å–æ–≤ (SL) –∏ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–æ–≤ (TP) –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è —Å–¥–µ–ª–∫–∏ —á–µ—Ä–µ–∑ Tinkoff Invest API (gRPC), –∏—Å–ø–æ–ª—å–∑—É—è –±–∏–±–ª–∏–æ—Ç–µ–∫—É invest-python
.

‚öôÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

–°—Ä–µ–¥–∞:

–†–∞–±–æ—Ç–∞ –Ω–∞ Windows –∏ macOS

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Python 3.10+

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ invest-python

–ü–æ–¥–¥–µ—Ä–∂–∫–∞ gRPC-–º–µ—Ç–æ–¥–æ–≤ (–Ω–µ REST)

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞–º–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —á–µ—Ä–µ–∑ mcp context7

–¶–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã:

–ü–æ—Å–ª–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è —Å–¥–µ–ª–∫–∏ (–ø–æ–∫—É–ø–∫–∞/–ø—Ä–æ–¥–∞–∂–∞) ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—Å—Ç–∞–≤–ª—è—Ç—å SL –∏ TP —á–µ—Ä–µ–∑ gRPC-–º–µ—Ç–æ–¥—ã Tinkoff Invest API.

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã –ø–æ–∑–∏—Ü–∏–∏ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ª–æ—Ç–æ–≤ ‚Äî –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å –∏ –ø–µ—Ä–µ–≤—ã—Å—Ç–∞–≤–ª—è—Ç—å SL –∏ TP.

–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è:

–ê–∫—Ü–∏–π (–ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã)

–§—å—é—á–µ—Ä—Å–æ–≤ (—á–µ—Ä–µ–∑ —à–∞–≥ —Ü–µ–Ω—ã –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å —à–∞–≥–∞)

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–≥–æ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–∞ (—á–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ —Ä–∞–∑–Ω—ã—Ö —Ü–µ–ª–µ–π –ø—Ä–∏–±—ã–ª–∏).

–ì–∏–±–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:

–û–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã SL/TP –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é;

–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —Ç–∏–∫–µ—Ä—É;

–û—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ñ—å—é—á–µ—Ä—Å—ã –Ω–∞ –∏–Ω–¥–µ–∫—Å, –≤–∞–ª—é—Ç—É, –∞–∫—Ü–∏–∏);

–†–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä: +1%, +2%, +3% —Å —á–∞—Å—Ç–∏—á–Ω—ã–º –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ 25%, 25%, 50%).

–°—Ç–æ–π–∫–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

–°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏.

–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É—Å—Ç–æ–π—á–∏–≤–∞ –∫ –≤—Ä–µ–º–µ–Ω–Ω—ã–º –æ–±—Ä—ã–≤–∞–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è gRPC.

–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ç–æ–∫–µ–Ω API) –¥–æ–ª–∂–Ω—ã —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ (env-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ / .env-—Ñ–∞–π–ª).

–í–µ–¥–µ–Ω–∏–µ –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –ª–æ–≥–æ–≤ (–æ—à–∏–±–∫–∏, –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤, –ø–µ—Ä–µ—Å—á–µ—Ç—ã).

üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–µ–¥–ª–æ–∂–∏ –º–æ–¥—É–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É (–ø—Ä–∏–º–µ—Ä):

/auto_trading_system/
‚îÇ
‚îú‚îÄ‚îÄ main.py                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
‚îú‚îÄ‚îÄ config_manager.py       # –ß—Ç–µ–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (JSON/YAML)
‚îú‚îÄ‚îÄ grpc_client.py          # –†–∞–±–æ—Ç–∞ —Å gRPC-–º–µ—Ç–æ–¥–∞–º–∏ invest-python
‚îú‚îÄ‚îÄ order_watcher.py        # –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø–æ—Ç–æ–∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–π —Å–¥–µ–ª–æ–∫
‚îú‚îÄ‚îÄ order_manager.py        # –í—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ/–æ—Ç–º–µ–Ω–∞/–ø–µ—Ä–µ–≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ risk_manager.py         # –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ SL/TP
‚îú‚îÄ‚îÄ state_manager.py        # –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—Ä–¥–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ multi_tp_manager.py     # –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç (—á–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ)
‚îú‚îÄ‚îÄ context_handler.py      # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º —á–µ—Ä–µ–∑ mcp context7
‚îî‚îÄ‚îÄ logs/
    ‚îî‚îÄ‚îÄ system.log

üî¢ –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —É—Ä–æ–≤–Ω–µ–π
–î–ª—è –∞–∫—Ü–∏–π:
if position.direction == "LONG":
    stop_price = avg_price * (1 - stop_loss_pct / 100)
    take_price = avg_price * (1 + take_profit_pct / 100)
else:  # SHORT
    stop_price = avg_price * (1 + stop_loss_pct / 100)
    take_price = avg_price * (1 - take_profit_pct / 100)

–î–ª—è —Ñ—å—é—á–µ—Ä—Å–æ–≤:
stop_price = avg_price - stop_loss_steps * instrument.price_step
take_price = avg_price + take_profit_steps * instrument.price_step


–≥–¥–µ stop_loss_steps –∏ take_profit_steps —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∏—Å—Ö–æ–¥—è –∏–∑ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ —Ä–∏—Å–∫–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —à–∞–≥–∞ (step_price).

–î–ª—è –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–≥–æ —Ç–µ–π–∫-–ø—Ä–æ—Ñ–∏—Ç–∞:

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫ —É—Ä–æ–≤–Ω–µ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä:

multi_take_profit:
  - { level: 1.01, volume_pct: 25 }   # +1%, –∑–∞–∫—Ä—ã—Ç—å 25%
  - { level: 1.02, volume_pct: 25 }   # +2%, –∑–∞–∫—Ä—ã—Ç—å 25%
  - { level: 1.03, volume_pct: 50 }   # +3%, –∑–∞–∫—Ä—ã—Ç—å 50%


–ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è ‚Äî –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –æ—Ä–¥–µ—Ä –Ω–∞ —á–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ.

–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É—é—Ç—Å—è –æ—Å—Ç–∞–≤—à–∏–µ—Å—è SL/TP —É—Ä–æ–≤–Ω–∏.

üì° –†–∞–±–æ—Ç–∞ —Å gRPC-–º–µ—Ç–æ–¥–∞–º–∏ Tinkoff Invest

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã –∏–∑ invest-python, –Ω–∞–ø—Ä–∏–º–µ—Ä:

OrdersStreamService ‚Äî –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–π —Å–¥–µ–ª–æ–∫;

OrdersService.PostOrder ‚Äî –¥–ª—è –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è SL/TP –æ—Ä–¥–µ—Ä–æ–≤;

OrdersService.CancelOrder ‚Äî –¥–ª—è –ø–µ—Ä–µ–≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è;

InstrumentsService.GetInstrumentByTicker ‚Äî –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —à–∞–≥–∞ —Ü–µ–Ω—ã –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —à–∞–≥–∞ —Ñ—å—é—á–µ—Ä—Å–∞;

OperationsStreamService ‚Äî –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ–∑–∏—Ü–∏–π –∏ —Å—Ä–µ–¥–Ω–µ–π —Ü–µ–Ω—ã.

üíæ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (SL/TP %, —à–∞–≥–∏, —É—Ä–æ–≤–Ω–∏ TP, —Ç–∏–∫–µ—Ä—ã, API-—Ç–æ–∫–µ–Ω) —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ config.yaml.

–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π –∏ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤ ‚Äî –≤ state.json –∏–ª–∏ SQLite.

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–∏—Å—Ç–µ–º–∞:

–ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ API —á–µ—Ä–µ–∑ gRPC.

–ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å—Ç—Ä–∏–º –ø–æ–∑–∏—Ü–∏–π.

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç SL/TP –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–∑–∏—Ü–∏–∏.

üß† –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ mcp context7

–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º, –≤ —Ç–æ–º —á–∏—Å–ª–µ:

–æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–∏–∫–µ—Ä–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ;

–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–æ—Ç–æ–∫–æ–≤ –ø—Ä–∏ –æ–±—Ä—ã–≤–∞—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è;

—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏.
